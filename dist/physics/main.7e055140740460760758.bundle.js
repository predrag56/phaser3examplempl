!function(t){function e(e){for(var n,s,a=e[0],c=e[1],h=e[2],u=0,l=[];u<a.length;u++)s=a[u],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&l.push(o[s][0]),o[s]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);for(d&&d(e);l.length;)l.shift()();return r.push.apply(r,h||[]),i()}function i(){for(var t,e=0;e<r.length;e++){for(var i=r[e],n=!0,a=1;a<i.length;a++){var c=i[a];0!==o[c]&&(n=!1)}n&&(r.splice(e--,1),t=s(s.s=i[0]))}return t}var n={},o={0:0},r=[];function s(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=n,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="static/physics";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=e,a=a.slice();for(var h=0;h<a.length;h++)e(a[h]);var d=c;r.push([571,1]),i()}({1493:function(t,e){},1496:function(t,e,i){"use strict";i.r(e);i(572);var n,o={type:Phaser.HEADLESS,parent:"phaser-game",width:1280,height:720,banner:!1,audio:!1},r={default:"arcade",arcade:{gravity:{y:1500}}},s={default:"matter",matter:{gravity:{y:2}}},a=i(570),c=i.n(a),h={DUDE:0,BOX:1,STAR:2,MUMMY:3},d=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),u=function(t){function e(){return t.call(this,{key:"PreloadScene"})||this}return d(e,t),e.prototype.preload=function(){this.load.setBaseURL("static/client"),this.load.image(h.BOX.toString(),"assets/box.png"),this.load.image(h.STAR.toString(),"assets/star.png"),this.load.image("bug","assets/bug.png"),this.load.image("starfield","assets/starfield.jpg"),this.load.image("controls","assets/controls.png"),this.load.spritesheet(h.DUDE.toString(),"assets/dude.png",{frameWidth:32,frameHeight:48}),this.load.spritesheet("fullscreen","assets/fullscreen.png",{frameWidth:64,frameHeight:64}),this.load.spritesheet(h.MUMMY.toString(),"assets/mummy37x45.png",{frameWidth:37,frameHeight:45})},e.prototype.create=function(){var t,e=this;(t=this).anims.create({key:"left",frames:t.anims.generateFrameNumbers(h.DUDE.toString(),{start:0,end:3}),frameRate:10,repeat:-1}),t.anims.create({key:"idle",frames:[{key:h.DUDE.toString(),frame:4}],frameRate:20}),t.anims.create({key:"right",frames:t.anims.generateFrameNumbers(h.DUDE.toString(),{start:5,end:8}),frameRate:10,repeat:-1}),function(t){t.anims.create({key:"walk",frames:t.anims.generateFrameNumbers(h.MUMMY.toString(),{}),frameRate:16,repeat:7})}(this);var i=location.origin+"/G",n=c.a.connect(i,{transports:["websocket"]});n.on("reconnect_attempt",(function(){n.io.opts.transports=["polling","websocket"]})),n.on("connect",(function(){console.log("You're connected to socket.io")})),n.on("clientId",(function(t){n.clientId=t,console.log("Your client id",t),e.scene.start("MenuScene",{socket:n})}))},e}(Phaser.Scene),l=function(t){var e=window.innerWidth,i=window.innerHeight,n=Math.min(e/896,i/504),o=Math.min(e/n,1344),r=Math.min(i/n,756),s=1,a=function(t,e,i){return(t-e)/(i-e)};s=896/504<e/i?-a(o/r,896/504,1344/504)/(1/(1.15-1))+1.15:-a(o/r,896/504,896/756)/(1/(1.15-1))+1.15,t.scale.resize(o*s,r*s),t.canvas.style.width=o*n+"px",t.canvas.style.height=r*n+"px",t.canvas.style.marginTop=(i-r*n)/2+"px",t.canvas.style.marginLeft=(e-o*n)/2+"px"},p=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),f=function(t){function e(){return t.call(this,{key:"MenuScene"})||this}return p(e,t),e.prototype.init=function(t){var e=t.socket;this.socket=e},e.prototype.create=function(){var t=this,e={color:"#000000",align:"center",fontSize:52},i=[];i.push(this.add.text(0,0,"Choose which Level\nyou want to play",e).setOrigin(.5,0)),i.push(this.add.text(0,0,"Matter Physics",e).setOrigin(.5,0).setInteractive().on("pointerdown",(function(){t.scene.start("MainScene",{scene:"MatterScene",level:0,socket:t.socket})}))),i.push(this.add.text(0,0,"Arcade Physics (Level 1)",e).setOrigin(.5,0).setInteractive().on("pointerdown",(function(){t.scene.start("MainScene",{scene:"ArcadeScene",level:0,socket:t.socket})}))),i.push(this.add.text(0,0,"Arcade Physics (Level 2)",e).setOrigin(.5,0).setInteractive().on("pointerdown",(function(){t.scene.stop(),t.scene.start("MainScene",{scene:"ArcadeScene",level:1,socket:t.socket})}))),i.push(this.add.text(0,0,"Arcade Physics (Level 3)",e).setOrigin(.5,0).setInteractive().on("pointerdown",(function(){t.scene.stop(),t.scene.start("MainScene",{scene:"ArcadeScene",level:2,socket:t.socket})})));var n=function(){var e=t.cameras.main,n=e.centerX,o=e.centerY,r=[20,o-100,o-10,o+60,o+130];i.forEach((function(t,e){t.setPosition(n,r[e])}))};this.scale.on("resize",(function(e,i,o,r){t.scene.isActive()&&(t.cameras.resize(e.width,e.height),n())})),n(),l(this.game)},e}(Phaser.Scene),y=[{y:230,fontSize:28,type:"server_running_time"},{y:260,fontSize:28,type:"the_room_id"},{y:290,fontSize:28,type:"show_connected_users"},{y:320,fontSize:28,type:"show_latency"},{y:350,fontSize:28,type:"show_fps"}],g=function(){function t(t){var e=this;this.scene=t,this.textObjects={},this.hidden=!1,y.forEach((function(i){var n=t.add.text(t.cameras.main.width/2,i.y,"",{color:"#ffffff",fontSize:i.fontSize}).setOrigin(.5).setResolution(window.devicePixelRatio).setScrollFactor(0).setDepth(100);e.textObjects[i.type]=n})),this.makeBug(),this.resize(),this.toggleHidden(),this.scene.events.on("update",this.update,this)}return t.prototype.update=function(){this.hidden||this.setFps(this.scene.game.loop.actualFps)},t.prototype.makeBug=function(){var t=this;this.bug=this.scene.add.image(0,0,"bug").setOrigin(0).setScrollFactor(0).setDepth(100),this.bug.setInteractive().on("pointerdown",(function(){t.toggleHidden()}))},t.prototype.toggleHidden=function(){for(var t in this.hidden=!this.hidden,this.textObjects)this.textObjects[t].setAlpha(this.hidden?0:1)},t.prototype.resize=function(){var t=this;y.forEach((function(e){t.textObjects[e.type].setPosition(t.scene.cameras.main.width/2,e.y)})),this.bug&&this.bug.setPosition(16,16)},t.prototype.setConnectCounter=function(t){this.textObjects.show_connected_users.setText("Connected users: "+t+"/4")},t.prototype.setRoomId=function(t){this.textObjects.the_room_id.setText("RoomId "+t)},t.prototype.setTime=function(t){this.textObjects.server_running_time.setText("Server is running since "+new Date(t).toUTCString())},t.prototype.setFps=function(t){this.textObjects.show_fps.setText("fps: "+Math.round(t))},t.prototype.setLatency=function(t){if(!isNaN(t.current)){(isNaN(t.high)||t.current>t.high)&&(t.high=t.current),(isNaN(t.low)||t.current<t.low)&&(t.low=t.current);var e=t.history.reduce((function(t,e){return e+t}))/t.history.length;this.textObjects.show_latency.setText("Latency "+t.current+"ms (avg "+Math.round(e)+"ms / low "+t.low+"ms / high "+t.high+"ms)")}},t}(),v=function(){function t(t,e){this.scene=t,this.socket=e,this.none=!0,this.prevNone=!0,this.left=!1,this.right=!1,this.up=!1,this.cursors=t.input.keyboard.createCursorKeys(),this.scene.events.on("update",this.update,this)}return t.prototype.cursorsDown=function(){return{left:this.left,right:this.right,up:this.up,none:this.none}},t.prototype.update=function(){if(this.cursors.left&&this.cursors.right&&this.cursors.up){if(this.none=!(this.cursors.left.isDown||this.cursors.right.isDown||this.cursors.up.isDown),!this.none||this.none!==this.prevNone)this.left=!1,this.right=!1,this.up=!1,this.cursors.left.isDown?this.left=!0:this.cursors.right.isDown&&(this.right=!0),this.cursors.up.isDown&&(this.up=!0);this.prevNone=this.none}},t}(),m=function(t){var e=t.add.image(0,0,"fullscreen",0).setOrigin(1,0).setInteractive().setScrollFactor(0).setDepth(100);return e.on("pointerup",(function(){t.scale.isFullscreen?(e.setFrame(0),t.scale.stopFullscreen()):(e.setFrame(1),t.scale.startFullscreen())})),e},b=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),w=function(){function t(t,e){var i=this;this.scene=t,this.socket=e,this.left=!1,this.right=!1,this.up=!1,this.controls=[],this.none=!0,this.prevNone=!0,t.input.addPointer();var n=function(t,e){if(t.btn)switch(t.btn){case"left":i.left=e;break;case"right":i.right=e;break;case"up":i.up=e}};t.input.on("gameobjectdown",(function(t,e){return n(e,!0)})),t.input.on("gameobjectup",(function(t,e){return n(e,!1)}));var o=new X(t,0,0,"left").setRotation(-.5*Math.PI),r=new X(t,0,0,"right").setRotation(.5*Math.PI),s=new X(t,0,0,"up");this.controls.push(o,r,s),this.resize(),this.scene.events.on("update",this.update,this)}return t.prototype.controlsDown=function(){return{left:this.left,right:this.right,up:this.up,none:this.none}},t.prototype.resize=function(){var t=this.scene.cameras.main.width-10-96,e=this.scene.cameras.main.height-10-96,i=[{x:106,y:e},{x:310,y:e},{x:t,y:e}];this.controls.forEach((function(t,e){t.setPosition(i[e].x,i[e].y),t.setScale(1)}))},t.prototype.update=function(){if(this.none=!(this.left||this.right||this.up),!this.none||this.none!==this.prevNone){var t=0;this.left&&(t+=1),this.right&&(t+=2),this.up&&(t+=4),this.none&&(t+=8),this.socket.emit("U",t)}this.prevNone=this.none},t}(),X=function(t){function e(e,i,n,o){var r=t.call(this,e,i,n,"controls")||this;return r.btn=o,e.add.existing(r),r.setInteractive().setScrollFactor(0).setAlpha(.5).setDepth(2),e.sys.game.device.input.touch||r.setAlpha(0),r}return b(e,t),e}(Phaser.GameObjects.Image),S=function(){return(S=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},_=function(){function t(){}return t.prepareFromPhaserGroup=function(e,i){e.children.iterate((function(e){t.prepareFromPhaserSprite(e,i)}))},t.prepareFromPhaserSprite=function(e,i){var n=S(S({},e),this.getXY(e));i.push(t.cleanObjectToSync(n))},t.prepareFromMatterGameObject=function(e,i){e.forEach((function(e){i.push(t.cleanObjectToSync(e))}))},t.getXY=function(t){return{x:t.body.position.x+t.body.width/2,y:t.body.position.y+t.body.height/2}},t.mergeObjectToSync=function(t,e){var i,n=!1;return Object.keys(e).forEach((function(i){i===t.id&&(e[t.id]=S(S({},e[t.id]),t),n=!0)})),n||(e=S(S({},e),((i={})[t.id]=t,i))),e},t.cleanObjectToSync=function(t){var e=function(t,e){var n;null!==e&&(i=S(S({},i),((n={})[t]=e,n)))},i={};return e("id",t.id||t.body.id),e("x",t.x||t.body.position.x||null),e("y",t.y||t.body.position.y||null),e("angle","undefined"!==t.angle?t.angle:null),e("dead","undefined"!==t.dead?t.dead:null),e("skin","undefined"!==t.skin?t.skin:null),e("animation",t.animation||null),e("direction",t.direction||null),e("scale",t.scale&&1!==t.scale?t.scale:null),e("tint",t.tint?t.tint:null),e("clientId",t.clientId||null),e("category",t.category||null),i},Object.defineProperty(t,"keys",{get:function(){return["id","x","y","angle","dead","skin","animation","direction","scale","tint","clientId","category"]},enumerable:!1,configurable:!0}),t.decode=function(e){var i=t.keys,n=[],o={};return e.split(",").forEach((function(t,e){var r=i[e%i.length];"id"===r?o[r]=parseInt(t,36).toString():["skin","scale"].includes(r)?o[r]=""!==t?parseInt(t):null:["x","y","angle","clientId"].includes(r)?o[r]=""!==t?parseInt(t,36):null:["dead"].includes(r)?o[r]="0"!==t&&("1"===t||null):o[r]=""!==t?t:null,e%i.length==i.length-1&&(n.push(S({},o)),o={})})),n},t.encode=function(e){var i=t.keys,n="";return e.forEach((function(t){i.forEach((function(e){if(void 0!==t[e]){var i=t[e];"boolean"==typeof t[e]?i=!1===t[e]?0:1:["id","x","y","angle","clientId"].includes(e)&&(i=(i=+(i=+i).toFixed(0)).toString(36)),n+=i+","}else n+=","}))})),n.slice(0,-1)},t}(),O=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),x=function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n},k=function(t){function e(){var e=t.call(this,{key:"MainScene"})||this;return e.objects={},e.sync={initialState:!1,objects:[]},e.latency={current:NaN,high:NaN,low:NaN,ping:NaN,id:"",canSend:!0,history:[]},e.level=0,e}return O(e,t),e.prototype.init=function(t){var e=t.scene,i=t.level,n=void 0===i?0:i,o=t.socket;this.level=n,this.socket=o,this.socket.emit("joinRoom",{scene:e,level:n})},e.prototype.create=function(){var t=this,e=this.socket,i=this.add.text(0,0,"Level "+(this.level+1),{color:"#ffffff",fontSize:42}).setOrigin(.5,0).setDepth(100).setScrollFactor(0),n=this.add.tileSprite(P.x,P.y,P.width,P.height,"starfield").setOrigin(0);this.cursors=new v(this,e),this.controls=new w(this,e);var o=new g(this),r=m(this);this.cameras.main.setBounds(P.x,P.y,P.width,P.height),e.on("getPong",(function(e){t.latency.id===e&&(t.latency.canSend=!0,t.latency.current=(new Date).getTime()-t.latency.ping,t.latency.history.length>=200&&t.latency.history.shift(),t.latency.history.push(t.latency.current),o.setLatency(t.latency))})),this.time.addEvent({delay:250,loop:!0,callback:function(){t.latency.canSend&&(o.hidden||(t.latency.ping=(new Date).getTime(),t.latency.id=Phaser.Math.RND.uuid(),t.latency.canSend=!1,e.emit("sendPing",t.latency.id)))}}),e.on("changingRoom",(function(n){console.log("You are changing room"),Object.keys(t.objects).forEach((function(e){t.objects[e].sprite.destroy(),delete t.objects[e]})),e.emit("getInitialState"),t.level=0|n.level,i.setText("Level "+(t.level+1))})),e.on("S",(function(i){i.connectCounter&&o.setConnectCounter(i.connectCounter),i.time&&o.setTime(i.time),i.roomId&&o.setRoomId(i.roomId),i.O&&(i.O=_.decode(i.O),t.sync.objects=x(t.sync.objects,i.O),t.sync.objects.forEach((function(i){if(t.objects[i.id]&&i.skin===h.DUDE&&i.clientId&&+i.clientId==+e.clientId&&t.cameras.main.setScroll(i.x-t.cameras.main.width/2,i.y-t.cameras.main.height/2),!t.objects[i.id]){var n=t.add.sprite(i.x,i.y,i.skin.toString()).setOrigin(.5).setRotation(i.angle||0);t.objects[i.id]={sprite:n}}var o=t.objects[i.id].sprite;i.scale&&o.setScale(i.scale),i.tint&&o.setTint(i.tint),o.setVisible(!i.dead)})))})),e.emit("getInitialState"),this.game.events.on("focus",(function(){return e.emit("getInitialState")})),this.input.on("pointerdown",(function(t){console.log(t.worldX,t.worldY)}));this.scale.on("resize",(function(e,s,a,c){t.cameras.resize(e.width,e.height),n.setScale(Math.max(t.cameras.main.height/n.height,1)),o.resize(),t.controls&&t.controls.resize(),r.setPosition(t.cameras.main.width-16,16),t.cameras.main.setScroll(t.cameras.main.worldView.x,P.height),i.setPosition(t.cameras.main.width/2,20)})),l(this.game)},e.prototype.update=function(t,e){var i=this;this.sync.objects.length>0&&this.sync.objects.forEach((function(t){if(i.objects[t.id]){var e=i.objects[t.id].sprite;null!==t.dead&&e.setVisible(!t.dead),null!==t.x&&(e.x=t.x),null!==t.y&&(e.y=t.y),null!==t.angle&&void 0!==t.angle&&(e.angle=t.angle),null!==t.skin&&(t.skin===h.MUMMY&&null!==t.direction&&function(t,e){t.anims.isPlaying||t.anims.play("walk");var i="left"===e;t.setFlipX(i)}(e,t.direction),t.skin===h.DUDE&&null!==t.animation&&function(t,e){void 0===e&&(e="idle"),t.anims.isPlaying?t.anims.isPlaying&&t.anims.getCurrentKey()!==e&&t.play(e):t.play(e)}(e,t.animation))}})),this.sync.objects=[]},e}(Phaser.Scene),P={x:0,y:0,width:2560,height:864},j=(Phaser.WEBGL,Phaser.Scale.NONE,function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}()),M=function(t){function e(e,i,n,o){var r=t.call(this,e,n,o,"")||this;return r.skin=h.BOX,r.sync=!0,e.add.existing(r),e.physics.add.existing(r,!0),r.body.setSize(95,95).setOffset(-32,-32),r.id=i.toString(),r}return j(e,t),e}(Phaser.Physics.Arcade.Sprite),I=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),D=function(){return(D=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},A=function(t){function e(e,i,n){var o=t.call(this,e,0,0,"")||this;return o.skin=h.DUDE,o.updates={},o.shouldUpdate=!0,o.prevPosition={x:-1,y:-1},o.dead=!1,o.prevDead=!1,o.color=16777215,o.prevColor=16777215,o.animation=void 0,o.hit=!1,e.add.existing(o),e.physics.add.existing(o),o.setFrame(0),o.socketId=n.socketId,o.clientId=n.clientId,o.setNewPosition(),o.setCollideWorldBounds(!0).setOrigin(0),o.body.setSize(32,48),o.id=i.toString(),o}return I(e,t),e.prototype.setNewPosition=function(){this.setPosition(Phaser.Math.RND.integerInRange(0,1e3),Phaser.Math.RND.integerInRange(100,300))},e.prototype.postUpdate=function(){this.prevPosition=D({},this.body.position),this.prevDead=this.dead,this.prevColor=this.color},e.prototype.gotHit=function(){var t=this;this.hit||(this.hit=!0,this.color=16711680,this.scene.time.addEvent({delay:3500,callback:function(){t.hit=!1,t.color=16777215}}))},e.prototype.update=function(){this.active&&this.shouldUpdate&&(this.shouldUpdate=!1,this.updates.left?this.setVelocityX(-400):this.updates.right?this.setVelocityX(400):this.setVelocityX(0),this.updates.up&&this.body.blocked.down&&this.setVelocityY(-600),this.animation=this.body.velocity.x>=.5?"right":this.body.velocity.x<=-.5?"left":"idle",this.updates={})},e.prototype.revive=function(t,e){this.setActive(!0),this.dead=!1,this.setNewPosition(),this.clientId=t,this.socketId=e},e.prototype.kill=function(){this.setActive(!1),this.dead=!0},e.prototype.setUpdates=function(t){this.shouldUpdate=!0,this.updates=t},e}(Phaser.Physics.Arcade.Sprite),B=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),T=function(t){function e(e,i,n,o){var r=t.call(this,e,n,o,"")||this;return r.skin=h.STAR,r.sync=!0,r.tint=65280,e.add.existing(r),e.physics.add.existing(r,!0),r.body.setSize(24,22,!1),r.id=i.toString(),r}return B(e,t),e}(Phaser.Physics.Arcade.Sprite),E=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),R=function(t){function e(e,i,n,o){var r=t.call(this,e,n,o,"")||this;return r.skin=h.MUMMY,r.dead=!1,e.add.existing(r),e.physics.add.existing(r),r.setFrame(0),r.direction=Math.random()>.5?"left":"right",r.body.setSize(37,45),r.id=i.toString(),r}return E(e,t),e.prototype.kill=function(){var t=this;this.dead||(this.dead=!0,this.scene.time.addEvent({delay:5e3,callback:function(){return t.dead=!1}}))},e.prototype.getLookAhead=function(){return{x:"right"===this.direction?this.body.right+5:this.body.left-5,y:this.body.bottom+10}},e.prototype.changeDirection=function(t){"X"!==t.tile&&(this.direction="right"===this.direction?"left":"right")},e.prototype.move=function(){var t="right"===this.direction?35:-35;this.dead&&(t=0),this.setVelocityX(t)},e.prototype.update=function(){this.move()},e}(Phaser.Physics.Arcade.Sprite),U=function(){function t(t,e,i){this.scene=t,this.world=e,this.level=i,this.tileSize=95,this.levels=[["    XXX  M    M      XXXXXX","        XX       X X       "," XX  X X   XXXXX     X     ","   M    M         M X    G ","XX    XXXX       XXX     X ","XXXX       X   X       X   "],["                           ","        M        X X       "," XX  X XXXXX XXX     X     "," G      M           X      ","XX    XXXX M     XXX     X ","XXXX XXXXXXXXX X       X   "],["           M       G       ","        XXXXXXX  X X       "," XX  X XXXXX XXX     X     ","        M           X      ","XX    XXXX       XXX     X ","XXXX XXXXXXXXX X       X   "]],this.margin={y:3*this.tileSize+11+45,x:e.x+45}}return t.prototype.collideRect=function(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y},t.prototype.getTileByCoordinates=function(t){var e=this,i=t.x,n=t.y,o={tile:"",x:-1,y:-1};return this.getLevel().forEach((function(t,r){for(var s=0;s<t.length;s++){var a=s*e.tileSize+e.margin.x,c=r*e.tileSize+e.margin.y;if(a-=45,c-=45,e.collideRect({x:i,y:n,width:1,height:1},{x:a,y:c,width:e.tileSize,height:e.tileSize})){o={tile:t[s],x:a,y:c};break}}})),o},t.prototype.countTotalLevels=function(){return this.levels.length},t.prototype.getLevel=function(){return this.levels[this.level]},t}(),L=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),N=function(t){function e(){var e=t.call(this,{key:"MainScene",plugins:null,active:!1,cameras:null})||this;return e.id=0,e.debug={},e.level=0,e.objectsToSync={},e.tick=0,e}return L(e,t),e.prototype.newId=function(){return this.id++},e.prototype.init=function(){try{var t=this.game.config.preBoot(),e=t.level,i=void 0===e?0:e,n=t.roomId,o=t.roomManager;this.level=i,this.roomManager=o,this.roomId=n}catch(t){0}},e.prototype.create=function(){var t=this;this.events.addListener("stopScene",(function(){t.roomManager.stats.removeTotalObjects(t.roomId),t.scene.stop(),t.roomManager.stats.log("Scene in roomId <b>"+t.roomId+"</b> has stopped!")})),this.physics.world.setBounds(P.x,P.y,P.width,P.height),this.dudeGroup=this.add.group(),this.boxGroup=this.add.group(),this.mummyGroup=this.add.group(),this.map=new U(this,P,this.level),this.map.getLevel().forEach((function(e,i){for(var n=0;n<e.length;n++){var o=n*t.map.tileSize+t.map.margin.x,r=i*t.map.tileSize+t.map.margin.y;"X"===e[n]&&t.boxGroup.add(new M(t,t.newId(),o,r)),"G"===e[n]&&(t.star=new T(t,t.newId(),o,r)),"M"===e[n]&&t.mummyGroup.add(new R(t,t.newId(),o,r))}})),this.add.text(24,24,"Physics Debugging Version\nMove with Arrow Keys",{fontSize:36}).setScrollFactor(0).setOrigin(0).setAlpha(.6),this.debug.socket={emit:function(){}},this.debug.cursors=new v(this,this.debug.socket),this.debug.dude=new A(this,this.newId(),{clientId:55555,socketId:"some-socket-id"}),this.dudeGroup.add(this.debug.dude),this.input.on("pointerdown",(function(e){console.log(e.worldX,e.worldY),console.log(t.map.getTileByCoordinates({x:e.worldX,y:e.worldY}))})),this.events.addListener("createDude",(function(e,i){var n=t.dudeGroup.getFirstDead();n?n.revive(e,i):(n=new A(t,t.newId(),{clientId:e,socketId:i}),t.dudeGroup.add(n))})),this.events.addListener("U",(function(e){var i=t.dudeGroup.children.getArray().filter((function(t){return t.clientId&&t.clientId===e.clientId}));if(i[0]){var n=e.updates,o={left:1===n||5===n,right:2===n||6===n,up:4===n||6===n||5===n,none:8===n};i[0].setUpdates(o)}})),this.events.addListener("removeDude",(function(e){t.dudeGroup.children.iterate((function(t){t.clientId===e&&t.kill()}))})),this.physics.add.collider(this.dudeGroup,this.boxGroup),this.physics.add.collider(this.mummyGroup,this.boxGroup),this.physics.add.overlap(this.mummyGroup,this.dudeGroup,(function(t,e){t.dead||(t.body.touching.up&&e.body.touching.down?(e.setVelocityY(-300),t.kill()):e.gotHit())})),this.physics.add.overlap(this.dudeGroup,this.star,(function(e,i){if(!e.dead){e.kill();var n=t.level+1>=t.map.countTotalLevels()?0:t.level+1,o=t.roomManager.ioNspGame.sockets[e.socketId];t.roomManager.changeRoom(o,"ArcadeScene",n)}}))},e.prototype.getInitialState=function(){var t=[];return _.prepareFromPhaserGroup(this.boxGroup,t),_.prepareFromPhaserGroup(this.dudeGroup,t),_.prepareFromPhaserSprite(this.star,t),_.encode(t)},e.prototype.update=function(){var t=this;this.tick++,this.tick>1e6&&(this.tick=0),this.mummyGroup.children.iterate((function(e){var i=e.getLookAhead(),n=t.map.getTileByCoordinates(i);e.changeDirection(n),e.update()})),this.debug.cursors.update();var e=this.debug.cursors.cursorsDown(),i=this.debug.dude;i.setUpdates(e),i.update(),this.cameras.main.setScroll(i.body.position.x-this.cameras.main.width/2,i.body.position.y-.8*this.cameras.main.height)},e}(Phaser.Scene),z=function(){return(z=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},G=function(){function t(t,e){this.scene=t,this.skin=e,this.clientId=void 0,this.dead=!1,this.prevDead=!1,this.angle=0,this.prevAngle=-1,this.animation="idle",this.prevAnimation="idle",this.tint=0,this.Matter=Phaser.Physics.Matter.Matter}return t.prototype.addBody=function(t){this.body=t,this.body.prevVelocity={x:0,y:0},this.scene.matter.world.add(this.body)},t.prototype.addBodies=function(t){this.body=this.Matter.Body.create({parts:t.map((function(t){return t}))}),this.body.prevVelocity={x:0,y:0},this.scene.matter.world.add(this.body)},t.prototype.preUpdate=function(t){void 0===t&&(t=void 0),this.angle=Phaser.Math.RadToDeg(this.body.angle)},t.prototype.update=function(t){void 0===t&&(t=void 0)},t.prototype.postUpdate=function(t){void 0===t&&(t=void 0),this.dead&&!this.prevDead?this.prevDead=!0:!this.dead&&this.prevDead&&(this.prevDead=!1),this.body.prevVelocity=z({},this.body.velocity),this.prevAngle=this.angle,this.prevAnimation=this.animation},t.prototype.revive=function(t,e,i,n){void 0===i&&(i=void 0),void 0===n&&(n=void 0),this.kill(!1),this.Matter.Body.setPosition(this.body,{x:t,y:e})},t.prototype.kill=function(t){void 0===t&&(t=!0),this.dead=t,t&&this.Matter.Body.setPosition(this.body,{x:-1e3,y:-1e3}),this.Matter.Sleeping.set(this.body,t)},t}(),F=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),V=function(t){function e(e,i,n,o,r){var s=t.call(this,e,h.DUDE)||this;s.clientId=o,s.socketId=r,s.maxVelocity={x:6,y:12},s.width=32,s.height=48,s.shouldUpdate=!0,s.translateX=0,s.translateY=0,s.jumpLocked=!1,s.move={leftAllowed:!0,rightAllowed:!0},s.touching={left:!1,right:!1,bottom:!1},s.updates={};var a=s.height,c=s.width-4;return console.log("clientId",o),s.mainBody=s.Matter.Bodies.rectangle(i,n,c,a,{density:.001,friction:.1,frictionStatic:.1,label:"dude",chamfer:{radius:10}}),s.sensors={bottom:s.Matter.Bodies.rectangle(i,n+a/2+1,.35*c,4,{isSensor:!0}),left:s.Matter.Bodies.rectangle(i-c/2-2,n+0,4,.9*a,{isSensor:!0}),right:s.Matter.Bodies.rectangle(i+c/2+2,n+0,4,.9*a,{isSensor:!0})},s.addBodies([s.mainBody,s.sensors.bottom,s.sensors.left,s.sensors.right]),s.setSensorLabel(),s.Matter.Body.setInertia(s.body,1/0),s}return F(e,t),e.prototype.setTranslate=function(t,e){void 0===e&&(e=0),this.translateX=t,this.translateY=e},e.prototype.translate=function(){0===this.translateX&&0===this.translateY||(this.Matter.Body.setPosition(this.body,{x:this.body.position.x+this.translateX,y:this.body.position.y+this.translateY}),this.translateX=0,this.translateY=0)},e.prototype.setSensorLabel=function(){this.sensors.bottom.label="dudeBottomSensor_"+this.clientId,this.sensors.left.label="dudeLeftSensor_"+this.clientId,this.sensors.right.label="dudeRightSensor_"+this.clientId},e.prototype.revive=function(e,i,n,o){t.prototype.revive.call(this,e,i),this.clientId=n,this.socketId=o,this.setSensorLabel()},e.prototype.lockJump=function(){var t=this;this.jumpLocked=!0,this.scene.time.addEvent({delay:250,callback:function(){return t.jumpLocked=!1}})},e.prototype.setUpdates=function(t){this.shouldUpdate=!0,this.updates=t},e.prototype.update=function(t){if(void 0===t&&(t=!1),this.animation="idle",t||this.shouldUpdate){var e=this.updates,i=e.left&&this.move.leftAllowed?-.01:e.right&&this.move.rightAllowed?.01:0,n=!this.jumpLocked&&e.up&&this.touching.bottom?-this.maxVelocity.y:0;0!==n&&this.lockJump(),0!==n&&this.Matter.Body.setVelocity(this.body,{x:this.body.velocity.x,y:n}),this.Matter.Body.applyForce(this.body,{x:0,y:0},{x:i,y:0});var o=this.body.velocity.x>this.maxVelocity.x?1:this.body.velocity.x<-this.maxVelocity.x?-1:null;o&&this.Matter.Body.setVelocity(this.body,{x:this.maxVelocity.x*o,y:this.body.velocity.y}),e.left||e.right||this.Matter.Body.setVelocity(this.body,{x:.5*this.body.velocity.x,y:this.body.velocity.y}),this.animation=this.body.velocity.x>=.5?"right":this.body.velocity.x<=-.5?"left":"idle",this.translate(),this.touching={left:!1,right:!1,bottom:!1},this.move={leftAllowed:!0,rightAllowed:!0},this.updates={},this.shouldUpdate=!1}},e}(G),Y=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),C=function(t){function e(e,i,n){var o=t.call(this,e,h.BOX)||this;return o.scene=e,o.addBody(o.Matter.Bodies.rectangle(i,n,95,95,{friction:.1,chamfer:{radius:14},label:"box",density:125e-6})),o.lifeTime=Phaser.Math.RND.integerInRange(15e3,45e3),o.setTimer(),o}return Y(e,t),e.prototype.setTimer=function(){var t=this;this.scene.time.addEvent({delay:this.lifeTime,callback:function(){t.kill()}})},e.prototype.revive=function(e,i){t.prototype.revive.call(this,e,i),this.setTimer()},e}(G),H=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),W=function(t){function e(e,i,n,o){void 0===o&&(o=void 0);var r=t.call(this,e,h.STAR)||this;return r.scene=e,r.x=i,r.y=n,r.category=o,r.scale=1,"big"===o&&(r.tint=16740864,r.scale=3),"medium"===o&&(r.scale=2),r.addBody(r.Matter.Bodies.rectangle(i,n,24*r.scale,22*r.scale,{chamfer:{radius:14},label:"star",isStatic:!0,isSensor:!0})),r}return H(e,t),e.prototype.setReviveTimer=function(){var e=this;this.scene.time.addEvent({delay:15e3,callback:function(){t.prototype.revive.call(e,e.x,e.y)}})},e.prototype.kill=function(t){void 0===t&&(t=!0),this.dead=t,t&&this.Matter.Body.setPosition(this.body,{x:-1e3,y:-1e3}),this.Matter.Sleeping.set(this.body,t)},e}(G),J=function(){function t(t,e){this.scene=t,this.objects=e,this.Matter=Phaser.Physics.Matter.Matter}return t.prototype.killById=function(t){this.objects.forEach((function(e){e.body.id===t&&e.kill()}))},t.prototype.getObjectById=function(t){var e=void 0;return this.objects.forEach((function(i){i.body.id===t&&(e=i)})),e},t.prototype.add=function(t,e,i,n){void 0===n&&(n={});var o=this.objects.filter((function(t){return t.dead&&t.skin===i})),r=this.objects.filter((function(t){return!t.dead&&t.skin===i})),s=n.clientId,a=n.socketId,c=n.category;if(!(r.length>=100)){var d=null;return o.length>0?(d=o[0]).revive(t,e,s,a):(i===h.BOX?d=new C(this.scene,t,e):i===h.STAR?d=new W(this.scene,t,e,c):void 0!==s&&void 0!==a&&(d=new V(this.scene,t,e,s,a)),d&&this.objects.push(d)),i===h.BOX&&d&&this.Matter.Body.rotate(d.body,2*Math.random()),d}},t}(),K=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),q=function(t){function e(){var e=t.call(this,{key:"MainScene",plugins:null})||this;return e.objects=[],e.objectsToSync={},e.debug={},e.tick=0,e}return K(e,t),e.prototype.init=function(){try{var t=this.game.config.preBoot(),e=t.level,i=void 0===e?0:e,n=t.roomId,o=t.roomManager;this.level=i,this.roomManager=o,this.roomId=n}catch(t){0}},e.prototype.create=function(){var t=this,e=Phaser.Physics.Matter.Matter,i=(P.x+P.width)/2,n=this.matter.world.setBounds(P.x,P.y,P.width,P.height);Object.keys(n.walls).forEach((function(t){var i=n.walls[t];e.Body.set(i,{friction:.05,frictionStatic:.05,frictionAir:.01}),"top"===t&&e.Body.set(i,{isSensor:!0})}));var o=new J(this,this.objects);this.events.addListener("stopScene",(function(){t.objects.forEach((function(e){t.matter.world.remove(t.matter.world,e.body)})),t.roomManager.stats.removeTotalObjects(t.roomId),t.scene.stop(),t.roomManager.stats.log("Scene in roomId <b>"+t.roomId+"</b> has stopped!")})),this.events.addListener("createDude",(function(e,i){var n=Phaser.Math.RND.integerInRange(P.x+100,t.cameras.main.width/2-640),r=Phaser.Math.RND.integerInRange(t.cameras.main.width/2+640,P.x+P.width-100),s=Math.random()>.5?n:r;o.add(s,-50,h.DUDE,{clientId:e,socketId:i})})),this.events.addListener("U",(function(e){var i=t.objects.filter((function(t){return t.clientId&&t.clientId===e.clientId}));if(i[0]){var n=e.updates,o={left:1===n||5===n,right:2===n||6===n,up:4===n||6===n||5===n,none:8===n};i[0].setUpdates(o)}})),this.events.addListener("removeDude",(function(e){t.objects.filter((function(t){return t.clientId&&t.clientId===e})).forEach((function(t){return t.kill()}))})),this.time.addEvent({delay:1200,loop:!0,callback:function(){var t=Phaser.Math.RND.integerInRange(i-250-640,i+640+250);o.add(t,100,h.BOX)}}),this.add.text(24,24,"Physics Debugging Version\nMove with Arrow Keys",{fontSize:36}).setScrollFactor(0).setOrigin(0).setAlpha(.6),this.debug.socket={emit:function(){}},this.debug.cursors=new v(this,this.debug.socket),this.debug.dude=o.add(400,400,h.DUDE,{clientId:55555,socketId:"some-socket-id"}),o.add(i,P.height-320-100-115,h.STAR,{category:"big"});for(var r=i-128;r<i+128+64;r+=128)o.add(r,P.height-320-100,h.STAR,{category:"medium"});for(r=i-160-80;r<i+320+80;r+=160)o.add(r,P.height-320,h.STAR);o.add(1280,640,h.BOX),o.add(1280,640,h.BOX),o.add(1280,640,h.BOX),o.add(1280,640,h.BOX);var s=function(t){t.pairs.forEach((function(t){var e=t.bodyA,i=t.bodyB,n=[e.label,i.label];if(n.includes("dude")&&n.includes("star")){var r="star"===e.label?e:i,s=o.getObjectById(r.id);s&&(s.kill(),s.setReviveTimer())}if(/Sensor/.test(e.label)||/Sensor/.test(i.label)){var a=/Sensor/.test(e.label)?e:i,c=/Sensor/.test(e.label)?i:e;if(c.isSensor)return;var h=o.getObjectById(a.parent.id);if(h){var d=2;c.isStatic&&(d=.1);var u=t.separation-d;a===h.sensors.left?(h.move.leftAllowed=!c.isStatic,h.touching.left=!0,t.separation>d&&(h.setTranslate(u),h.translate())):a===h.sensors.right?(h.move.rightAllowed=!c.isStatic,h.touching.right=!0,t.separation>d&&(h.setTranslate(-u),h.translate())):a===h.sensors.bottom&&(h.touching.bottom=!0)}}}))};this.matter.world.on("collisionstart",s),this.matter.world.on("collisionactive",s)},e.prototype.getInitialState=function(){var t=[];return _.prepareFromMatterGameObject(this.objects,t),_.encode(t)},e.prototype.update=function(t,e){this.tick++,this.tick>1e6&&(this.tick=0),this.debug.cursors.update();var i=this.debug.cursors.cursorsDown(),n=this.debug.dude;n.setUpdates(i),n.update(),this.cameras.main.setScroll(n.body.position.x-this.cameras.main.width/2,n.body.position.y-.8*this.cameras.main.height)},e}(Phaser.Scene),Q=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Z=function(){return(Z=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},$=function(t){function e(e,i){var n=t.call(this,i)||this;return n.io=e,n.debug=!0,n}return Q(e,t),e}(Phaser.Game),tt=function(t){var e=Z({},o),i=location.href;return e.type=Phaser.AUTO,e.scale={mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},/arcade/.test(i)&&(e.scene=[N],e.physics=r,e.physics.arcade.debug=!0),/matter/.test(i)&&(e.scene=[q],e.physics=s,e.physics.matter&&(e.physics.matter.debug=!0)),new $(t,e)},et={emit:function(){},on:function(){},in:function(){},connected:"connected"};window.addEventListener("load",(function(){window.game=tt(et)}))},571:function(t,e,i){t.exports=i(1496)}});